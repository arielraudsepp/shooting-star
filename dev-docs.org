#+TITLE: Dev Docs

* About
This DBT/Mindfulness app will provide a way to track customizable skills, offer practices and provide data on progress.

It will be a web-based application. The home-screen will require the user to log into their account. They will then be able to select the date from a calendar they want to add data. It will display the skills they have chosen have displayed and they will input data. The data will be saved in the database. Users can view historical data and view the help section.

* Approach
- problem-based learning drawn from "Zero to Prod in Rust"
** User Stories
- capture the who we are building it for, the actions they want to perform, and their motives
- as a ... I want to.. so that...
1) As a user,
    I want to store my scores for multiple skills each day,
    So that I can track progress
2) As a user,
    I want to view stored scores,
    So that I can review progress
** Stack
- App server: Rust with Postgres, actix
- Frontend: React with Typescript

* Linting and Formatting
** Linting
#+begin_src
cargo clippy
#+end_src
** Formatting
#+begin_src
cargo fmt
#+end_src
* Docker
** Recompile shell files (database and redis)
#+begin_src zsh
chmod +x scripts/init_db.sh
chmod +x scripts/init_redis.sh
#+end_src

** Launch Postgres and Redis containers
#+begin_src shell
./scripts/init_db.sh
./scripts/init_redis.sh
#+end_src

#+RESULTS:
| 8c0045887c9d08ef717d0a52d97f321e235e4112f98a10ebcaf575de6d4031b5 |                        |        |        |        |               |              |
| Applied                                                          | 20211228003329/migrate | create | diary  | skills | table         | (9.046322ms) |
| Applied                                                          | 20211228005507/migrate | create | skills | table  | (14.362536ms) |              |
| Applied                                                          | 20211228005520/migrate | create | diary  | table  | (8.125442ms)  |              |
| Applied                                                          | 20220410172326/migrate | create | users  | table  | (16.307401ms) |              |
| Applied                                                          | 20211228003329/migrate | create | diary  | skills | table         | (2.837576ms) |
| Applied                                                          | 20211228005507/migrate | create | skills | table  | (20.679719ms) |              |
| Applied                                                          | 20211228005520/migrate | create | diary  | table  | (8.627682ms)  |              |
| Applied                                                          | 20220410172326/migrate | create | users  | table  | (23.186138ms) |              |
| 3763ea029da149cf0b2ba7dc42f2f9344cd8ed72eb2ece206689ce2fbccc13bb |                        |        |        |        |               |              |

** Kill Postgres Server
#+begin_src shell
docker kill $(docker ps -q)
#+end_src

#+RESULTS:
: 003ba494132e

* Postgres
** Migrate Database
#+begin_src shell
SKIP_DOCKER=true ./scripts/init_db.sh
#+end_src

#+RESULTS:

** Seed the database
#+begin_src shell
cargo run --bin run_seeds
#+end_src

#+RESULTS:

* API
** Health Check
#+begin_src restclient
GET http://localhost:8000/health_check
#+end_src

#+RESULTS:
#+BEGIN_SRC js
// GET http://localhost:8000/health_check
// HTTP/1.1 200 OK
// content-length: 0
// set-cookie: _flash=; Path=/; Max-Age=0
// vary: Origin, Access-Control-Request-Method, Access-Control-Request-Headers
// date: Wed, 11 May 2022 20:26:21 GMT
// Request duration: 0.015194s
#+END_SRC

When running a health check we should return a 200.
#+NAME: Expected Health Check Response
#+BEGIN_SRC js
 // GET http://localhost:8000/health_check
 // HTTP/1.1 200 OK
 // content-length: 0
 // date: Thu, 30 Sep 2021 03:37:37 GMT
 // Request duration 0.029655s
#+END_SRC

#+RESULTS: Expected Health Check Response
** Diary Entries
*** Create Diary Entry
#+begin_src restclient
POST http://localhost:8000/diary_entries
Content-Type: application/json
{
  "entry_date": "2022-01-12T17:53:59Z",
  "skill_ids": [1, 5, 1]
}
#+end_src

#+RESULTS:
#+BEGIN_SRC js
{
  "id": 4,
  "entry_date": "2022-01-12",
  "created_at": "2022-05-11T20:26:34.036050Z"
}
// POST http://localhost:8000/diary_entries
// HTTP/1.1 201 Created
// content-length: 77
// content-type: application/json
// set-cookie: _flash=; Path=/; Max-Age=0
// vary: Origin, Access-Control-Request-Method, Access-Control-Request-Headers
// date: Wed, 11 May 2022 20:26:34 GMT
// Request duration: 0.141512s
#+END_SRC

*** Show Diary Entry by Date (Action: show)
#+begin_src restclient
GET http://localhost:8000/diary_entries/2022-01-12
#+end_src

#+RESULTS:
#+BEGIN_SRC js
{
  "id": 1,
  "entry_date": "2022-01-12",
  "created_at": "2022-05-09T17:48:05.218599Z"
}
// GET http://localhost:8000/diary_entries/2022-01-12
// HTTP/1.1 200 OK
// content-length: 77
// content-type: application/json
// set-cookie: _flash=; Path=/; Max-Age=0
// vary: Origin, Access-Control-Request-Method, Access-Control-Request-Headers
// date: Mon, 09 May 2022 17:48:17 GMT
// Request duration: 0.013358s
#+END_SRC

*** Show Diary Entry Skills by Date (Action: show)
#+begin_src restclient
GET http://localhost:8000/diary_entries/2022-01-12/skills
#+end_src

#+RESULTS:
#+BEGIN_SRC js
[
  {
    "diary_entry_id": 1,
    "skills_id": 1,
    "created_at": "2022-05-09T17:48:05.218599Z"
  },
  {
    "diary_entry_id": 1,
    "skills_id": 5,
    "created_at": "2022-05-09T17:48:05.218599Z"
  }
]
// GET http://localhost:8000/diary_entries/2022-01-12/skills
// HTTP/1.1 200 OK
// content-length: 157
// vary: Origin, Access-Control-Request-Method, Access-Control-Request-Headers
// content-type: application/json
// set-cookie: _flash=; Path=/; Max-Age=0
// date: Mon, 09 May 2022 17:48:33 GMT
// Request duration: 0.013837s
#+END_SRC

*** Index Diary Entries by Date Range (Action: index)
#+begin_src restclient
GET http://localhost:8000/diary_entries?start=2021-10-01&end=2022-10-20
#+end_src

#+RESULTS:
#+BEGIN_SRC js
[
  {
    "id": 1,
    "entry_date": "2022-01-12",
    "created_at": "2022-05-09T17:48:05.218599Z"
  }
]
// GET http://localhost:8000/diary_entries?start=2021-10-01&end=2022-10-20
// HTTP/1.1 200 OK
// content-length: 79
// vary: Origin, Access-Control-Request-Method, Access-Control-Request-Headers
// content-type: application/json
// set-cookie: _flash=; Path=/; Max-Age=0
// date: Mon, 09 May 2022 17:48:53 GMT
// Request duration: 0.013732s
#+END_SRC

** Skills
*** Show Skill by ID (Action: show)
#+begin_src restclient
GET http://localhost:8000/skills/21
#+end_src

*** Retrieve all Skills (Action: index)
#+begin_src restclient
GET http://localhost:8000/skills
#+end_src
** Credentials
*** Get Login
#+begin_src restclient
POST http://localhost:8000/login
Content-Type: application/json
{
  "username": "user",
  "password": "password"
}
#+end_src

#+RESULTS:
#+BEGIN_SRC js
3
// POST http://localhost:8000/login
// HTTP/1.1 200 OK
// content-length: 1
// set-cookie: id=oP+c2WAay7kGH%2F0npEVrQJH+RFmexHhO9MinMAcBw9tYxbE6XjeMi7H9Etmb2BPSHqomqRpnPrtj74qL1GujDkZwuYVUv%2Fcsj9qSEL87u0cLcjI+6V5TgQkZiiY%3D; HttpOnly; SameSite=Lax; Secure; Path=/
// vary: Origin, Access-Control-Request-Method, Access-Control-Request-Headers
// content-type: application/json
// date: Thu, 11 Aug 2022 16:55:58 GMT
// Request duration: 0.661302s
#+END_SRC


*** Get Signup
#+begin_src restclient
POST http://localhost:8000/signup
Content-Type: application/json
{
  "username": "user2",
  "password": "password"
}
#+end_src

#+RESULTS:
#+BEGIN_SRC js
// POST http://localhost:8000/signup
// HTTP/1.1 500 Internal Server Error
// content-length: 0
// vary: Origin, Access-Control-Request-Method, Access-Control-Request-Headers
// date: Thu, 11 Aug 2022 16:56:21 GMT
// Request duration: 0.692846s
#+END_SRC
