#+TITLE: Dev Docs

* About
This DBT/Mindfulness app will provide a way to track customizable skills, offer practices and provide data on progress.

It will be a web-based application. The home-screen will require the user to log into their account. They will then be able to select the date from a calendar they want to add data. It will display the skills they have chosen have displayed and they will input data. The data will be saved in the database. Users can view historical data and view the help section.

* Approach
- problem-based learning drawn from "Zero to Prod in Rust"
** User Stories
- capture the who we are building it for, the actions they want to perform, and their motives
- as a ... I want to.. so that...
1) As a user,
    I want to store my scores for multiple skills each day,
    So that I can track progress
2) As a user,
    I want to view stored scores,
    So that I can review progress
** Strategy
- choose a web framework
- define testing strategy
- choose a crate
** To do
- define struct for skills table
- fix return type for insert_entry fn, should not be a string until it needs to be
- need to wrap get_data in another function (as it currently returns HttpResponse or sqlx error, don't want to leak internal )
* Linting and Formatting
** Linting
#+begin_src
cargo clippy
#+end_src
** Formatting
#+begin_src
cargo fmt
#+end_src
* Docker
** Launch Postgres server
#+begin_src shell
chmod +x scripts/init_db.sh
./scripts/init_db.sh
#+end_src

#+RESULTS:
| 9d3a6e1e4ebc0c5c1284db0cb6f8f04a85625e65c7511b02aaeaab6ff8e4a21a |                        |                                                                                                                                                                                                                                                          |        |         |       |              |
| declare                                                          | -x                     | 15;0                                                                                                                                                                                                                                                     |        |         |       |              |
| declare                                                          | -x                     | truecolor                                                                                                                                                                                                                                                |        |         |       |              |
| declare                                                          | -x                     | unix2003                                                                                                                                                                                                                                                 |        |         |       |              |
| declare                                                          | -x                     | Ariel                                                                                                                                                                                                                                                    |        |         |       |              |
| declare                                                          | -x                     | Disthene.local                                                                                                                                                                                                                                           |        |         |       |              |
| declare                                                          | -x                     | /Users/ariel/.zsh_history                                                                                                                                                                                                                                |        |         |       |              |
| declare                                                          | -x                     | /Users/ariel                                                                                                                                                                                                                                             |        |         |       |              |
| declare                                                          | -x                     | /opt/homebrew/Cellar                                                                                                                                                                                                                                     |        |         |       |              |
| declare                                                          | -x                     | /opt/homebrew                                                                                                                                                                                                                                            |        |         |       |              |
| declare                                                          | -x                     | /opt/homebrew                                                                                                                                                                                                                                            |        |         |       |              |
| declare                                                          | -x                     | /opt/homebrew                                                                                                                                                                                                                                            |        |         |       |              |
| declare                                                          | -x                     | /opt/homebrew/share/info:                                                                                                                                                                                                                                |        |         |       |              |
| declare                                                          | -x                     | Default                                                                                                                                                                                                                                                  |        |         |       |              |
| declare                                                          | -x                     | w0t0p0:BC4936B1-0EF5-47D7-9318-EEE6A500D089                                                                                                                                                                                                              |        |         |       |              |
| declare                                                          | -x                     | en_CA.UTF-8                                                                                                                                                                                                                                              |        |         |       |              |
| declare                                                          | -x                     | iTerm2                                                                                                                                                                                                                                                   |        |         |       |              |
| declare                                                          | -x                     | 3.4.12                                                                                                                                                                                                                                                   |        |         |       |              |
| declare                                                          | -x                     | ariel                                                                                                                                                                                                                                                    |        |         |       |              |
| declare                                                          | -x                     | /opt/homebrew/share/man::                                                                                                                                                                                                                                |        |         |       |              |
| declare                                                          | -x                     | OLDPWD                                                                                                                                                                                                                                                   |        |         |       |              |
| declare                                                          | -x                     | /Users/ariel/.local/bin:/Users/ariel/.zinit/polaris/bin:/opt/homebrew/bin:/opt/homebrew/sbin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/Library/TeX/texbin:/Users/ariel/.cargo/bin:/Users/ariel/bin:/Users/ariel/.cargo/bin:/Users/ariel/.emacs.d/bin |        |         |       |              |
| declare                                                          | -x                     | password                                                                                                                                                                                                                                                 |        |         |       |              |
| declare                                                          | -x                     | 0uUpiPsf                                                                                                                                                                                                                                                 |        |         |       |              |
| declare                                                          | -x                     | /Users/ariel/dev/shooting-star                                                                                                                                                                                                                           |        |         |       |              |
| declare                                                          | -x                     | /bin/zsh                                                                                                                                                                                                                                                 |        |         |       |              |
| declare                                                          | -x                     | 3                                                                                                                                                                                                                                                        |        |         |       |              |
| declare                                                          | -x                     | /private/tmp/com.apple.launchd.0va6Tao6m4/Listeners                                                                                                                                                                                                      |        |         |       |              |
| declare                                                          | -x                     | 1994112863269251                                                                                                                                                                                                                                         |        |         |       |              |
| declare                                                          | -x                     | zsh                                                                                                                                                                                                                                                      |        |         |       |              |
| declare                                                          | -x                     | dumb                                                                                                                                                                                                                                                     |        |         |       |              |
| declare                                                          | -x                     | iTerm.app                                                                                                                                                                                                                                                |        |         |       |              |
| declare                                                          | -x                     | 3.4.12                                                                                                                                                                                                                                                   |        |         |       |              |
| declare                                                          | -x                     | w0t0p0:BC4936B1-0EF5-47D7-9318-EEE6A500D089                                                                                                                                                                                                              |        |         |       |              |
| declare                                                          | -x                     | /var/folders/tb/xxqcp_td4f122vqjvf7nrwm00000gn/T/                                                                                                                                                                                                        |        |         |       |              |
| declare                                                          | -x                     | ariel                                                                                                                                                                                                                                                    |        |         |       |              |
| declare                                                          | -x                     | 0x0                                                                                                                                                                                                                                                      |        |         |       |              |
| declare                                                          | -x                     | 0                                                                                                                                                                                                                                                        |        |         |       |              |
| declare                                                          | -x                     | /Users/ariel/.zinit/polaris                                                                                                                                                                                                                              |        |         |       |              |
| declare                                                          | -x                     | /Users/ariel/.cache/zinit                                                                                                                                                                                                                                |        |         |       |              |
| declare                                                          | -x                     | com.googlecode.iterm2                                                                                                                                                                                                                                    |        |         |       |              |
| declare                                                          | -x                     | 0x1F5:0x0:0x52                                                                                                                                                                                                                                           |        |         |       |              |
| Applied                                                          | 20211011201637/migrate | create                                                                                                                                                                                                                                                   | skills | tracker | table | (3.741416ms) |

** Kill Postgres Server
#+begin_src shell
docker kill $(docker ps -q)
#+end_src

#+RESULTS:
: 4de9b4a8d234

* Postgres
** Migrate Database
#+begin_src shell
SKIP_DOCKER=true ./scripts/init_db.sh
#+end_src

* API
** Health Check
#+begin_src restclient
GET http://localhost:8000/health_check
#+end_src

When running a health check we should return a 200.
#+NAME: Expected Health Check Response
#+BEGIN_SRC js
 // GET http://localhost:8000/health_check
 // HTTP/1.1 200 OK
 // content-length: 0
 // date: Thu, 30 Sep 2021 03:37:37 GMT
 // Request duration 0.029655s
#+END_SRC

#+RESULTS: Expected Health Check Response

** Enter Data
#+begin_src shell
curl -i -X POST -d 'name=mindfulness&completed=true' http://localhost:8000/enter_data
#+end_src

#+RESULTS:
| HTTP/1.1        |  200 | OK  |                                       |             |             |            |       |             |                             |   |
| content-length: |  136 |     |                                       |             |             |            |       |             |                             |   |
| date:           | Wed, | 10  | Nov                                   |        2021 |    00:15:44 | GMT        |       |             |                             |   |
|                 |      |     |                                       |             |             |            |       |             |                             |   |
| Record          |    { | id: | d8a0e2af-bd32-4057-9d72-e1755346cfcb, | skill_name: | mindfulness | completed: | true, | created_at: | 2021-11-10T00:15:44.894107Z | } |

** GET Data
#+begin_src restclient
GET http://localhost:8000/get_data/d8a0e2af-bd32-4057-9d72-e1755346cfc
#+end_src

#+RESULTS:
: #+BEGIN_SRC text
: ID: d8a0e2af-bd32-4057-9d72-e1755346cfc
: GET http://localhost:8000/get_data/d8a0e2af-bd32-4057-9d72-e1755346cfc
: HTTP/1.1 200 OK
: content-length: 39
: content-type: text/plain
: date: Wed, 10 Nov 2021 00:16:10 GMT
: Request duration: 0.029802s
: #+END_SRC
